# sean - project setup

Created with the [grunt-init gui template](https://github.com/GuardianInteractive/grunt-init-template).

***

1. Install grunt and its dependencies
-------------------------------------
This applies whether you are initialising the project, or you've cloned the repo from GitHub (as development dependencies are excluded from the repo by .gitignore):

    $ # do npm install --no-registry if you already all the modules cached - quicker, and works offline
    $ npm install

***

This section obviously only applies if you are initialising the project.

2. Create local repo
--------------------
    $ git init
    $ git add .
    $ git commit -m 'first commit woo!'


3. Create remote repo
---------------------
For clarity, it is recommended that you give the repo the same name as this project (**sean)**:

<http://github.com/organizations/GuardianInteractive/repositories/new>


4. Link the two
---------------
Assuming you called the remote repo **sean**, you would do

    $ git remote add origin https://github.com/GuardianInteractive/sean.git
    $ git push -u origin master

***

5. Start grunting
-----------------
    $ grunt

This is the equivalent of doing `grunt build` followed by `grunt watch`. The project will be built in the `build/dev` folder, and any changes to files in the `src` folder will cause a rebuild.

View the project by starting a webserver (if you don't have Apache running by default) and pointing your browser to the `build/dev` folder.

> *It is recommended that you edit your [hosts file](http://en.wikipedia.org/wiki/Hosts_(file)) so that `local.theguardian.com` redirects to `localhost`. This avoids cross-domain nonsense, e.g. with fonts.

***

6. Create your app
------------------

It helps to understand the anatomy of the project template:

* **`build`**
Everything in this folder is generated by grunt. Don't change anything in here - the changes will be overwritten with the next build.

* **`gubbins (non-tracked)`**
Stuff you need to keep handy for the project, but don't want to check into version control (e.g. large images)

* **`gubbins (tracked)`**
Anything related to the project that you *do* want to check in (e.g. shell scripts)

* **`src`**
The project itself

    * `index.html`
    The page containing the interactive. This loads curl.js (the module loader), which in turn loads boot.js and kicks things off.

    * `codeobject.html`
    The markup for the interactive. Typically consists of a `<figure class='interactive'>` with a loading indicator and a message for non-JS people.

    * `boot.js`
    An AMD module with a `boot` method that adheres to the [specification outlined here](https://gist.github.com/commuterjoy/e0fdd862a27ac463ef5a). (This might look over-engineered, but it will make sense in the context of the next-gen website.) The boot file is responsible for a) doing feature detection and, where necessary, graceful degradation, and b) loading the project CSS, configuring the module loader, and launching the app.

    * `boot.css`
    Any CSS that needs to be loaded immediately (such as for the loading indicator)

    * `preview.html`
    Use this file to see how the project will look at different dimensions

    * **`versioned`**
    Files in here get uploaded to a different folder with each deploy; that way, they can have a long cache time.

        * `data`
        Any data you need in the app can go in here - it will be flattened to a single JSON file or to an AMD module depending on your Gruntfile.js `dir2json` configuration. (AMD module is a better solution if the data is small, say <30kb.) [Docs here.](https://github.com/GuardianInteractive/grunt-dir2json)

        * `files`
        Assets that are small enough that you don't mind uploading them to S3 with each new version, e.g. icons.

        * `js`
        The `app.js` file is the entry point for the app, and is an AMD module.

        * `styles`
        The `main.scss` file gets compiled to `min.css` by grunt.




7. Create an optimised version
------------------------------
    
    $ grunt min

This will build the project to `build/min`, allowing you to test that it optimises correctly.

When grunt builds an optimised version of the app, it starts at `app.js` and traces all the files that it depends on (directly or indirectly), bundling them all into a single file, using the configuration specified in the Gruntfile's `requirejs` task. For this reason, any changes to the AMD config at the start of `boot.js` (such as `paths` and `shims` need to be reflected in the Gruntfile.


8. Deploy
---------
You will need to have AWS credentials, either in your environment or in a JSON file somewhere. To add credentials to your environment on OS X, open `~/.bash_profile` and add the following lines (with your details, natch):

    export AWS_ACCESS_KEY_ID='yourKeyIdHere'
    export AWS_SECRET_ACCESS_KEY='yourSecretAccessKeyHere'

Alternatively add the credentials to a JSON file, and specify its path as the `credentials` option to the `deploy` task:

    {
    	"accessKeyId": "yourKeyIdHere",
    	"secretAccessKey": "yourSecretAccessKeyHere"
    }

It is possible to specify credentials directly within the task config. **Do not do this.** You may accidentally push your credentials to GitHub.

To deploy, simply do

    $ grunt deploy

This will upload the project to our S3 account (the `gdn-cdn` bucket). It will then be accessible from <http://interactive.guim.co.uk/2013/sep/sean/v/1/index.html> (the version number will increment with each deploy).